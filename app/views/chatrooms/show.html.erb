
<% my_first_chatroom_user = ChatroomUser.find( @chatroom.chatroom_user_ids.first ) %>
<% my_sec_chatroom_user = ChatroomUser.find( @chatroom.chatroom_user_ids.last ) %>
<%  my_first_user = User.find(my_first_chatroom_user[:user_id])  %>
<%  my_sec_user = User.find(my_sec_chatroom_user[:user_id])  %>


<h2> Potential buyer is <%= my_first_user.nickname %> </h1>
<h2>Potential Seller (artist) is <%= my_sec_user.nickname %> </h2> 
<p> Songs currently available: </p>
<ul>
<% my_sec_user.songs.each do |song| %>
  <li>
    <% if song.state == "available" %>
      <%= song.name %>
      <% if song.dollar == true  %>
        <p>  Buyout Price $<%=song.price  %> 
      <%  else  %>
        Royalty <%=  song.price  %> %  </p>    
      <% end %>
  </li>
  <% end %> 

<% end %>
</ul>


<div id="messages" data-chatroom-id="<%= @chatroom.id %>">
  <%  if @chatroom.users.include? current_user %> 
    <% @chatroom.messages.each do |message| %>
      <div class="message-container" id="#message-<%= message.id %>">
        <i class="author">
          <span><%= message.chatroom_user.user.nickname %></span>
          <!-- the line below is a cludgy hack for now to adjust for daylight saving) -->
          <% adjusted_datetime = (message.created_at - 1.hours) %>
          <small><%= adjusted_datetime.strftime("%a %b %e at %l:%M%p") %></small>
        </i>
        <p><%= message.content %></p>
    
      </div>
    <% end %>
  <% end %>
</div>

<%= simple_form_for [ @chatroom, @message ], remote: true do |f| %>
  <%= f.input :content, label: false, placeholder: "Your message to get that deal! " %>

<% end %>
 <h1><%= link_to "Stop haggling!", chatroom_path(@chatroom), class: "btn btn-danger", method: :delete, data: { confirm: "Are you sure? All haggle messages will be lost?" } %></h1>


 